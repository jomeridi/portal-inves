---
import { NAVIGATION } from '@config/site';

import MobileMenu from '@components/react/MobileMenu';

import { languages } from '../i18n/ui';

const { currentPathname } = Astro.props;

// Normalize paths by removing trailing slashes for comparison
const normalizePath = (path: string) => path.endsWith('/') && path.length > 1 ? path.slice(0, -1) : path;
const isActiveLink = (href: string) : boolean => {
  const normalizedCurrent = normalizePath(currentPathname);
  const normalizedHref = normalizePath(href);
  return normalizedCurrent === normalizedHref;
};

// Detect current locale from pathname
const segments = currentPathname.split('/').filter(Boolean);
const currentLocale = (segments[0] && Object.keys(languages).includes(segments[0])) ? segments[0] : 'es';
const navItems = NAVIGATION[currentLocale as keyof typeof NAVIGATION] || NAVIGATION.es;

const getLocalizedPath = (pathname: string, locale: string) => {
  const segments = pathname.split('/').filter(Boolean);
  const currentLang = segments[0];
  if (currentLang && Object.keys(languages).includes(currentLang)) {
    segments[0] = locale;
  } else {
    segments.unshift(locale);
  }
  return '/' + segments.join('/');
};

---

<header class="sticky top-0 z-50 w-full border-b border-slate-200 bg-white/95 backdrop-blur-md shadow-sm">
  <nav class="container mx-auto flex h-20 items-center justify-between px-4 sm:px-6 lg:px-8">
    <!-- Logo -->
    <div class="flex items-center">
      <a href="/" class="flex items-center space-x-3 group">
        <img src="/logo-azul.svg" alt="Inv-es logo" class="h-10 w-auto rounded-lg group-hover:scale-110 transition-transform" />
      </a>
    </div>

    <!-- Desktop Navigation -->
    <div class="hidden lg:flex lg:items-center lg:space-x-1">
      {navItems.map((item) => {
        const isActive = isActiveLink(item.href);
        return (
        <a
          href={item.href}
          class={`px-4 py-2 text-sm font-medium text-slate-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all relative group ${isActive ? 'nav-active' : ''}`}
        >
          {item.name}
        </a>
      );
      })}
    </div>

    <!-- Language Selector -->
    <div class="hidden lg:flex lg:items-center lg:space-x-4">
      <div class="flex items-center space-x-3 border-l border-slate-200 pl-4">
        {Object.keys(languages).map((lang) => (
          <a
            href={getLocalizedPath(currentPathname, lang)}
            class={`text-sm font-semibold transition-colors ${
              currentPathname.startsWith(`/${lang}`) 
                ? 'text-blue-600' 
                : 'text-slate-500 hover:text-slate-900'
            }`}
          >
            {lang.toUpperCase()}
          </a>
        ))}
      </div>
    </div>

    <!-- Mobile Menu Button -->
    <MobileMenu client:idle navItems={navItems} />
  </nav>
</header>
